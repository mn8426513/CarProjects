"use strict";const e=require("../../../../common/vendor.js"),s=require("../../common/login-page.mixin.js"),n=e.er.importObject("uni-id-co",{errorOptions:{type:"toast"}}),i={mixins:[s.mixin],data:()=>({password:"",username:"",captcha:"",needCaptcha:!1,focusUsername:!1,focusPassword:!1,logo:"/static/logo.png",existAdmin:!0}),onShow(){},async onLoad(){try{const s=e.er.database();let n=(await s.collection("uni-id-users").where({role:"admin"}).count()).result.total;this.existAdmin=n>0}catch(s){this.existAdmin=!1}},methods:{toRetrievePwd(){let s="/uni_modules/uni-id-pages/pages/retrieve/retrieve";/^1\d{10}$/.test(this.username)&&(s+=`?phoneNumber=${this.username}`),e.index.navigateTo({url:s})},pwdLogin(){if(!this.password.length)return this.focusPassword=!0,e.index.showToast({title:"请输入密码",icon:"none",duration:3e3});if(!this.username.length)return this.focusUsername=!0,e.index.showToast({title:"请输入手机号/用户名/邮箱",icon:"none",duration:3e3});if(this.needCaptcha&&4!=this.captcha.length)return this.$refs.captcha.getImageCaptcha(),e.index.showToast({title:"请输入验证码",icon:"none",duration:3e3});if(this.needAgreements&&!this.agree)return this.$refs.agreements.popup(this.pwdLogin);let s={password:this.password,captcha:this.captcha};/^1\d{10}$/.test(this.username)?s.mobile=this.username:/@/.test(this.username)?s.email=this.username:s.username=this.username,n.login(s).then((e=>{this.loginSuccess(e)})).catch((e=>{"uni-id-captcha-required"==e.errCode?this.needCaptcha=!0:this.needCaptcha&&this.$refs.captcha.getImageCaptcha()}))},toRegister(){e.index.navigateTo({url:this.config.isAdmin?"/uni_modules/uni-id-pages/pages/register/register-admin":"/uni_modules/uni-id-pages/pages/register/register",fail(e){console.error(e)}})}}};if(!Array){(e.resolveComponent("uni-easyinput")+e.resolveComponent("uni-forms-item")+e.resolveComponent("uni-forms")+e.resolveComponent("uni-captcha")+e.resolveComponent("uni-id-pages-agreements")+e.resolveComponent("uni-id-pages-fab-login"))()}Math||((()=>"../../../uni-easyinput/components/uni-easyinput/uni-easyinput.js")+(()=>"../../../uni-forms/components/uni-forms-item/uni-forms-item.js")+(()=>"../../../uni-forms/components/uni-forms/uni-forms.js")+(()=>"../../../uni-captcha/components/uni-captcha/uni-captcha.js")+(()=>"../../components/uni-id-pages-agreements/uni-id-pages-agreements.js")+(()=>"../../components/uni-id-pages-fab-login/uni-id-pages-fab-login.js"))();const t=e._export_sfc(i,[["render",function(s,n,i,t,o,a){return e.e({a:o.logo,b:e.o((e=>o.focusUsername=!1)),c:e.o((e=>o.username=e)),d:e.p({focus:o.focusUsername,inputBorder:!1,placeholder:"请输入手机号/用户名/邮箱",modelValue:o.username}),e:e.p({name:"username"}),f:e.o((e=>o.focusPassword=!1)),g:e.o((e=>o.password=e)),h:e.p({focus:o.focusPassword,clearable:!0,type:"password",inputBorder:!1,placeholder:"请输入密码",modelValue:o.password}),i:e.p({name:"password"}),j:o.needCaptcha},o.needCaptcha?{k:e.sr("captcha","11fd9009-5"),l:e.o((e=>o.captcha=e)),m:e.p({focus:!0,scene:"login-by-pwd",modelValue:o.captcha})}:{},{n:e.sr("agreements","11fd9009-6"),o:e.p({scope:"login"}),p:e.o(((...e)=>a.pwdLogin&&a.pwdLogin(...e))),q:!s.config.isAdmin},s.config.isAdmin?{}:{r:e.o(((...e)=>a.toRetrievePwd&&a.toRetrievePwd(...e)))},{s:!o.existAdmin},o.existAdmin?{}:{t:e.t(s.config.isAdmin?"注册管理员账号":"注册账号"),v:e.o(((...e)=>a.toRegister&&a.toRegister(...e)))},{w:e.sr("uniFabLogin","11fd9009-7")})}],["__scopeId","data-v-11fd9009"]]);wx.createPage(t);
