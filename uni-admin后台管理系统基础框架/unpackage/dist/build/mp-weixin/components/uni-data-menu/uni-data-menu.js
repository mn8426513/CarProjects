"use strict";const e=require("../../common/vendor.js"),t=require("./util.js"),i={data:()=>({menus:[],userMenu:[],famliy:[]}),mixins:[e.er.mixinDatacom],props:{value:{type:String,default:""},activeTextColor:{type:String,default:"#42B983"},uniqueOpened:{type:Boolean,default:!1},staticMenu:{type:Array,default:()=>[]}},watch:{localdata:{handler(e){this.hasLocalData(e)&&(this.userMenu=e)},immediate:!0},$route:{immediate:!1,handler(e,t){if(e.fullPath!==t.fullPath){this.famliy=[];const t=this.menus.find((t=>t.value===e.path)),i=t&&t.menu_id;this.getMenuAncestor(i,this.menus),this.setRoutes&&this.setRoutes(this.famliy)}}}},created(){this.hasLocalData(this.localdata)||this.load()},methods:{...e.mapActions({setRoutes:"app/setRoutes"}),getUserMenu(i){const{permission:n,role:a}=e.er.getCurrentUserInfo();return i.map((e=>{i.some((t=>t.parent_id===e.menu_id))||(e.isLeafNode=!0)})),a.includes("admin")||(i=i.filter((e=>!e.isLeafNode||!(!e.permission||!e.permission.length)&&e.permission.some((e=>n.indexOf(e)>-1))))),t.buildMenus(i)},onSelect(e){this.famliy=[],this.getMenuAncestor(e.menu_id,this.menus),this.emit(e)},emit(e){this.$emit("select",e,this.famliy),this.$emit("input",e.value)},hasLocalData:e=>Array.isArray(e)&&e.length>0,load(){1!=this.mixinDatacomLoading&&(this.mixinDatacomLoading=!0,this.mixinDatacomGet().then((e=>{this.mixinDatacomLoading=!1;const{data:t,count:i}=e.result;this.menus=t,this.userMenu=this.getUserMenu(this.menus)})).catch((e=>{this.mixinDatacomLoading=!1,this.mixinDatacomErrorMessage=e})))},getMenuAncestor(e,t){t.forEach((i=>{if(i.menu_id===e){const e={name:i.text},n=i.value;n&&(e.to={path:n}),this.famliy.unshift(e);const a=i.parent_id;a&&this.getMenuAncestor(a,t)}}))}}};if(!Array){(e.resolveComponent("uni-menu-sidebar")+e.resolveComponent("uni-nav-menu"))()}Math||((()=>"../uni-menu-sidebar/uni-menu-sidebar.js")+(()=>"../uni-nav-menu/uni-nav-menu.js"))();const n=e._export_sfc(i,[["render",function(t,i,n,a,s,u){return{a:e.p({data:s.userMenu}),b:e.p({data:n.staticMenu}),c:e.o(u.onSelect),d:e.p({active:n.value,activeKey:"value",activeTextColor:n.activeTextColor,uniqueOpened:n.uniqueOpened})}}]]);wx.createComponent(n);
