"use strict";const e=require("./common/vendor.js"),t={name:"uni-stat-tabs",data:()=>({currentTab:0,renderTabs:[],cacheKey:"uni-admin-statTabsData"}),props:{type:{type:String,default:"line"},value:{type:[String,Number],default:""},modelValue:{type:[String,Number],default:""},current:{type:[String,Number],default:0},mode:{type:String,default:""},today:{type:Boolean,default:!1},yesterday:{type:Boolean,default:!0},disabled:{type:Boolean,default:!1},tooltip:{type:Boolean,default:!1},all:{type:Boolean,default:!0},label:{type:String,default:""},placeholder:{type:String,default:"暂无选项"},tabs:{type:Array,default:()=>[]}},created(){this.last=`${this.mode.replace("-","_")}_last_data`},mounted(){this.init()},computed:{},watch:{current:{immediate:!0,handler(e){this.currentTab=e}},tabs:{immediate:!1,handler(e){this.init()}},renderTabs(e){const t=this.current;this.mode&&e.length&&t>=0&&this.$nextTick((function(){const e=this.renderTabs[t];this.change(e,t)}))}},methods:{init(){if(this.mode.indexOf("platform")>-1)this.renderTabs=this.getCache()||[],this.getPlatform();else if("date"===this.mode){const e=[{_id:7,name:"最近七天"},{_id:30,name:"最近30天"},{_id:90,name:"最近90天"}];this.yesterday&&e.unshift({_id:1,name:"昨天"}),this.today&&e.unshift({_id:0,name:"今天"}),this.renderTabs=e}else this.renderTabs=this.tabs},change(e,t){if(e.disabled)return;const a=e._id,i=e.name;this.currentTab=t,this.emit(a,t,i,e)},emit(e,t,a,i){this.$emit("change",e,t,a,i),this.$emit("input",e,t,a),this.$emit("update:modelValue",e,t,a)},getPlatform(){e.er.database().collection("uni-stat-app-platforms").get().then((e=>{let t=e.result.data;if(t=t.filter((e=>!e.hasOwnProperty("enable")||e.enable)),t.sort(((e,t)=>e.order-t.order)),"platform-channel"===this.mode){t=t.filter((e=>/^android|ios|harmony$/.test(e.code)));let e=t.map((e=>`platform_id == "${e._id}"`)).join(" || ");e=`(${e})`,this.setAllItem(t,e)}else if("platform-scene"===this.mode){t=t.filter((e=>/mp-/.test(e.code)));let e=t.map((e=>`platform_id == "${e._id}"`)).join(" || ");e=`(${e})`,this.setAllItem(t,e)}else this.setAllItem(t);this.setCache(t),this.renderTabs=t}))},setAllItem(e,t="",a="全部"){this.all&&e.unshift({name:a,_id:t})},getCurrentCacheKey(){return this.mode},getCache(t=this.getCurrentCacheKey()){return(e.index.getStorageSync(this.cacheKey)||{})[t]},setCache(t,a=this.getCurrentCacheKey()){let i=e.index.getStorageSync(this.cacheKey)||{};i[a]=t,e.index.setStorageSync(this.cacheKey,i)},removeCache(t=this.getCurrentCacheKey()){let a=e.index.getStorageSync(this.cacheKey)||{};delete a[t],e.index.setStorageSync(this.cacheKey,a)}}};const a=e._export_sfc(t,[["render",function(t,a,i,n,s,r){return e.e({a:i.label},i.label?{b:e.t(i.label+"：")}:{},{c:!s.renderTabs.length},s.renderTabs.length?{f:e.f(s.renderTabs,((t,a,n)=>({a:e.t(t.name),b:a,c:e.o((e=>r.change(t,a)),a),d:e.n(a===s.currentTab?`uni-stat--tab-item-${i.type}-active`:""),e:e.n(t.disabled?"uni-stat--tab-item-disabled":"")}))),g:e.n(`uni-stat--tab-item-${i.type}`)}:{d:e.t(i.placeholder),e:e.n(`uni-stat--tab-item-${i.type}`)})}]]);exports.Component=a;
