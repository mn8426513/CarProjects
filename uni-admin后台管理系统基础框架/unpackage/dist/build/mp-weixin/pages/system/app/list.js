"use strict";const e=require("../../../common/vendor.js"),t=require("../../../js_sdk/validator/opendb-app-list.js"),a=e.er.database(),n=[],d={ascending:"asc",descending:"desc"},i={data:()=>({query:"",where:"",orderby:"create_date",orderByFieldName:"",selectedIndexs:[],options:{pageSize:20,pageCurrent:1,filterData:{},...t.enumConverter},imageStyles:{width:64,height:64},exportExcel:{filename:"opendb-app-list.xls",type:"xls",fields:{AppID:"appid","应用名称":"name","应用描述":"description","创建时间":"create_date"}},exportExcelData:[],addAppidLoading:!0,descriptionThWidth:380,buttonThWidth:400}),onLoad(){this._filter={}},onReady(){this.$refs.udb.loadData()},computed:{...e.mapState("app",["appName","appid"])},methods:{pageSizeChange(e){this.options.pageSize=e,this.options.pageCurrent=1,this.$nextTick((()=>{this.loadData()}))},onqueryload(e){e.find((e=>e.appid===this.appid))?this.addAppidLoading=!1:this.addCurrentAppid({appid:this.appid,name:this.appName,description:"admin 管理后台"}),this.exportExcelData=e},changeSize(e){this.pageSizeIndex=e.detail.value},addCurrentAppid(t){a.collection("opendb-app-list").add(t).then((t=>{this.loadData(),setTimeout((()=>{e.index.showModal({content:`检测到数据库中无当前应用, 已自动添加应用: ${this.appName}`,showCancel:!1})}),500)})).catch((e=>{})).finally((()=>{this.addAppidLoading=!1}))},getWhere(){const e=this.query.trim();if(!e)return"";const t=new RegExp(e,"i");return n.map((e=>t+".test("+e+")")).join(" || ")},search(){const e=this.getWhere();this.where=e,this.loadData()},loadData(e=!0){this.$refs.udb.loadData({clear:e})},onPageChanged(e){this.selectedIndexs.length=0,this.$refs.table.clearSelection(),this.$refs.udb.loadData({current:e.current})},navigateTo(t,a){e.index.navigateTo({url:t,events:{refreshData:()=>{this.loadData(a)}}})},selectedItems(){let e=this.$refs.udb.dataList;return this.selectedIndexs.map((t=>e[t]._id))},delTable(){console.warn("删除应用，只能删除应用表 opendb-app-list 中的应用数据记录，不能删除与应用关联的其他数据，例如：使用升级中心 uni-upgrade-center 等插件产生的数据（应用版本数据等）"),this.$refs.udb.remove(this.selectedItems(),{success:e=>{this.$refs.table.clearSelection()}})},selectionChange(e){this.selectedIndexs=e.detail.index},confirmDelete(e){console.warn("删除应用，只能删除应用表 opendb-app-list 中的应用数据记录，不能删除与应用关联的其他数据，例如：使用升级中心 uni-upgrade-center 等插件产生的数据（应用版本数据等）"),this.$refs.udb.remove(e,{confirmContent:"是否删除该应用",success:e=>{this.$refs.table.clearSelection()}})},sortChange(e,t){this.orderByFieldName=t,e.order?this.orderby=t+" "+d[e.order]:this.orderby="",this.$refs.table.clearSelection(),this.$nextTick((()=>{this.$refs.udb.loadData()}))},filterChange(e,n){this._filter[n]={type:e.filterType,value:e.filter};let d=t.filterToWhere(this._filter,a.command);Object.keys(d).length?this.where=d:this.where="",this.$nextTick((()=>{this.$refs.udb.loadData()}))},publish(t){e.index.navigateTo({url:"/pages/system/app/uni-portal/uni-portal?id="+t})}}};if(!Array){(e.resolveComponent("uni-stat-breadcrumb")+e.resolveComponent("uni-th")+e.resolveComponent("uni-tr")+e.resolveComponent("uni-td")+e.resolveComponent("uni-dateformat")+e.resolveComponent("uni-table")+e.resolveComponent("uni-pagination")+e.resolveComponent("unicloud-db")+e.resolveComponent("fix-window"))()}Math||((()=>"../../../components/uni-stat-breadcrumb/uni-stat-breadcrumb.js")+(()=>"../../../uni_modules/uni-table/components/uni-th/uni-th.js")+(()=>"../../../uni_modules/uni-table/components/uni-tr/uni-tr.js")+(()=>"../../../uni_modules/uni-table/components/uni-td/uni-td.js")+(()=>"../../../uni_modules/uni-dateformat/components/uni-dateformat/uni-dateformat.js")+(()=>"../../../uni_modules/uni-table/components/uni-table/uni-table.js")+(()=>"../../../uni_modules/uni-pagination/components/uni-pagination/uni-pagination.js")+(()=>"../../../node-modules/@dcloudio/uni-components/lib/unicloud-db/unicloud-db.js")+(()=>"../../../components/fix-window/fix-window.js"))();const o=e._export_sfc(i,[["render",function(t,a,n,d,i,o){return{a:e.o(((...e)=>o.search&&o.search(...e))),b:t.$t("common.placeholder.query"),c:i.query,d:e.o((e=>i.query=e.detail.value)),e:e.t(t.$t("common.button.search")),f:e.o(((...e)=>o.search&&o.search(...e))),g:e.t(t.$t("common.button.add")),h:e.o((e=>o.navigateTo("./add"))),i:e.t(t.$t("common.button.batchDelete")),j:!i.selectedIndexs.length,k:e.o(((...e)=>o.delTable&&o.delTable(...e))),l:e.w((({data:a,pagination:n,loading:d,error:r,options:s},p,c)=>({a:"2afd31cd-4-"+c+",2afd31cd-3-"+c,b:"2afd31cd-5-"+c+",2afd31cd-3-"+c,c:"2afd31cd-6-"+c+",2afd31cd-3-"+c,d:"2afd31cd-7-"+c+",2afd31cd-3-"+c,e:"2afd31cd-8-"+c+",2afd31cd-3-"+c,f:"2afd31cd-9-"+c+",2afd31cd-3-"+c,g:"2afd31cd-3-"+c+",2afd31cd-2-"+c,h:e.f(a,((a,n,d)=>({a:e.t(a.appid),b:"2afd31cd-11-"+c+"-"+d+",2afd31cd-10-"+c+"-"+d,c:e.t(a.name),d:"2afd31cd-12-"+c+"-"+d+",2afd31cd-10-"+c+"-"+d,e:e.t(a.description||"-"),f:"2afd31cd-13-"+c+"-"+d+",2afd31cd-10-"+c+"-"+d,g:e.t(a.remark||"-"),h:"2afd31cd-14-"+c+"-"+d+",2afd31cd-10-"+c+"-"+d,i:"2afd31cd-16-"+c+"-"+d+",2afd31cd-15-"+c+"-"+d,j:e.p({threshold:[0,0],date:a.create_date}),k:"2afd31cd-15-"+c+"-"+d+",2afd31cd-10-"+c+"-"+d,l:e.o((e=>o.publish(a._id)),n),m:e.o((e=>o.navigateTo("/uni_modules/uni-upgrade-center/pages/version/list?appid="+a.appid,!1)),n),n:e.o((e=>o.navigateTo("./add?id="+a.appid,!1)),n),o:e.o((e=>o.confirmDelete(a._id)),n),p:"2afd31cd-17-"+c+"-"+d+",2afd31cd-10-"+c+"-"+d,q:n,r:"2afd31cd-10-"+c+"-"+d+",2afd31cd-2-"+c,s:e.p({disabled:a.appid===t.appid})}))),i:e.sr("table","2afd31cd-2-"+c+",2afd31cd-1"),j:"2afd31cd-2-"+c+",2afd31cd-1",k:e.p({loading:d||i.addAppidLoading,emptyText:r.message||t.$t("common.empty"),border:!0,stripe:!0,type:"selection"}),l:"2afd31cd-18-"+c+",2afd31cd-1",m:e.o((e=>n.current=e)),n:e.p({"show-icon":!0,"show-page-size":!0,"page-size":n.size,total:n.count,modelValue:n.current}),o:c,p:p})),{name:"d",path:"l",vueId:"2afd31cd-1"}),m:e.o((e=>o.filterChange(e,"appid"))),n:e.o((e=>o.sortChange(e,"appid"))),o:e.p({align:"center","filter-type":"search",sortable:!0}),p:e.o((e=>o.filterChange(e,"name"))),q:e.o((e=>o.sortChange(e,"name"))),r:e.p({align:"center","filter-type":"search",sortable:!0}),s:e.o((e=>o.filterChange(e,"description"))),t:e.o((e=>o.sortChange(e,"description"))),v:e.p({align:"center","filter-type":"search",sortable:!0,width:i.descriptionThWidth}),w:e.p({align:"center"}),x:e.o((e=>o.filterChange(e,"create_date"))),y:e.o((e=>o.sortChange(e,"create_date"))),z:e.p({align:"center","filter-type":"timestamp",sortable:!0}),A:e.p({align:"center",width:i.buttonThWidth}),B:e.p({align:"center"}),C:e.p({align:"center"}),D:e.p({align:"left"}),E:e.p({align:"left"}),F:e.p({align:"center"}),G:e.t(t.$t("common.button.publish")),H:e.t(t.$t("common.button.version")),I:e.t(t.$t("common.button.edit")),J:e.t(t.$t("common.button.delete")),K:e.p({align:"center"}),L:e.o(o.selectionChange),M:e.o(o.onPageChanged),N:e.o(o.pageSizeChange),O:e.sr("udb","2afd31cd-1"),P:e.o(o.onqueryload),Q:e.p({collection:"opendb-app-list",field:"appid,name,description,remark,create_date",where:i.where,"page-data":"replace",orderby:i.orderby,getcount:!0,"page-size":i.options.pageSize,"page-current":i.options.pageCurrent,options:i.options,loadtime:"manual"})}}]]);wx.createPage(o);
