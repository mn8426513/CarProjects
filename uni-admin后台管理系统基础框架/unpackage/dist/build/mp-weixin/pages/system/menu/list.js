"use strict";const e=require("../../../common/vendor.js"),n=require("../../../components/uni-data-menu/util.js"),t=[{menu_id:"index",name:"首页",icon:"uni-icons-home",url:"/",sort:100,parent_id:"",permission:[],enable:!0,create_date:1602662469396},{menu_id:"system_management",name:"系统管理",icon:"admin-icons-fl-xitong",url:"",sort:1e3,parent_id:"",permission:[],enable:!0,create_date:1602662469396},{menu_id:"system_user",name:"用户管理",icon:"admin-icons-manager-user",url:"/pages/system/user/list",sort:1010,parent_id:"system_management",permission:[],enable:!0,create_date:1602662469398},{menu_id:"system_role",name:"角色管理",icon:"admin-icons-manager-role",url:"/pages/system/role/list",sort:1020,parent_id:"system_management",permission:[],enable:!0,create_date:1602662469397},{menu_id:"system_permission",name:"权限管理",icon:"admin-icons-manager-permission",url:"/pages/system/permission/list",sort:1030,parent_id:"system_management",permission:[],enable:!0,create_date:1602662469396},{menu_id:"system_menu",name:"菜单管理",icon:"admin-icons-manager-menu",url:"/pages/system/menu/list",sort:1040,parent_id:"system_management",permission:[],enable:!0,create_date:1602662469396},{menu_id:"system_app",name:"应用管理",icon:"admin-icons-manager-app",url:"/pages/system/app/list",sort:1035,parent_id:"system_management",permission:[],enable:!0,create_date:1602662469399},{menu_id:"system_update",name:"App升级中心",icon:"uni-icons-cloud-upload",url:"/uni_modules/uni-upgrade-center/pages/version/list",sort:1036,parent_id:"system_management",permission:[],enable:!0,create_date:1656491532434},{menu_id:"system_tag",name:"标签管理",icon:"admin-icons-manager-tag",url:"/pages/system/tag/list",sort:1037,parent_id:"system_management",permission:[],enable:!0,create_date:1602662479389},{permission:[],enable:!0,menu_id:"safety_statistics",name:"安全审计",icon:"admin-icons-safety",url:"",sort:3100,parent_id:"",create_date:1638356430871},{permission:[],enable:!0,menu_id:"safety_statistics_user_log",name:"用户日志",icon:"",url:"/pages/system/safety/list",sort:3101,parent_id:"safety_statistics",create_date:1638356430871},{permission:[],enable:!0,menu_id:"uni-stat",name:"uni 统计",icon:"admin-icons-tongji",url:"",sort:2100,parent_id:"",create_date:1638356430871},{parent_id:"uni-stat",permission:[],enable:!0,menu_id:"uni-stat-device",name:"设备统计",icon:"admin-icons-shebeitongji",url:"",sort:2120,create_date:1638356902516},{parent_id:"uni-stat-device",permission:[],enable:!0,menu_id:"uni-stat-device-overview",name:"概况",icon:"",url:"/pages/uni-stat/device/overview/overview",sort:2121,create_date:1638356902516},{parent_id:"uni-stat-device",permission:[],enable:!0,menu_id:"uni-stat-device-activity",name:"活跃度",icon:"",url:"/pages/uni-stat/device/activity/activity",sort:2122,create_date:1638356902516},{parent_id:"uni-stat-device",permission:[],enable:!0,menu_id:"uni-stat-device-trend",name:"趋势分析",icon:"",url:"/pages/uni-stat/device/trend/trend",sort:2123,create_date:1638356902516},{parent_id:"uni-stat-device",permission:[],enable:!0,menu_id:"uni-stat-device-retention",name:"留存",icon:"",url:"/pages/uni-stat/device/retention/retention",sort:2124,create_date:1638356902516},{parent_id:"uni-stat-device",permission:[],enable:!0,menu_id:"uni-stat-device-comparison",name:"平台对比",icon:"",url:"/pages/uni-stat/device/comparison/comparison",sort:2125,create_date:1638356902516},{parent_id:"uni-stat-device",permission:[],enable:!0,menu_id:"uni-stat-device-stickiness",name:"粘性",icon:"",url:"/pages/uni-stat/device/stickiness/stickiness",sort:2126,create_date:1638356902516},{parent_id:"uni-stat",permission:[],enable:!0,menu_id:"uni-stat-user",name:"注册用户统计",icon:"admin-icons-yonghutongji",url:"",sort:2122,create_date:1638356902516},{parent_id:"uni-stat-user",permission:[],enable:!0,menu_id:"uni-stat-user-overview",name:"概况",icon:"",url:"/pages/uni-stat/user/overview/overview",sort:2121,create_date:1638356902516},{parent_id:"uni-stat-user",permission:[],enable:!0,menu_id:"uni-stat-user-activity",name:"活跃度",icon:"",url:"/pages/uni-stat/user/activity/activity",sort:2122,create_date:1638356902516},{parent_id:"uni-stat-user",permission:[],enable:!0,icon:"",menu_id:"uni-stat-user-trend",name:"趋势分析",url:"/pages/uni-stat/user/trend/trend",sort:2123,create_date:1638356902516},{parent_id:"uni-stat-user",permission:[],enable:!0,menu_id:"uni-stat-user-retention",name:"留存",icon:"",url:"/pages/uni-stat/user/retention/retention",sort:2124,create_date:1638356902516},{parent_id:"uni-stat-user",permission:[],enable:!0,menu_id:"uni-stat-user-comparison",name:"平台对比",icon:"",url:"/pages/uni-stat/user/comparison/comparison",sort:2125,create_date:1638356902516},{parent_id:"uni-stat-user",permission:[],enable:!0,menu_id:"uni-stat-user-stickiness",name:"粘性",icon:"",url:"/pages/uni-stat/user/stickiness/stickiness",sort:2126,create_date:1638356902516},{parent_id:"uni-stat",permission:[],enable:!0,menu_id:"uni-stat-page-analysis",name:"页面统计",icon:"admin-icons-page-ent",url:"",sort:2123,create_date:1638356902516},{parent_id:"uni-stat-page-analysis",permission:[],enable:!0,menu_id:"uni-stat-page-res",name:"受访页",icon:"",url:"/pages/uni-stat/page-res/page-res",sort:2131,create_date:1638356902516},{parent_id:"uni-stat-page-analysis",permission:[],enable:!0,menu_id:"uni-stat-page-ent",name:"入口页",icon:"",url:"/pages/uni-stat/page-ent/page-ent",sort:2132,create_date:1638356902516},{parent_id:"uni-stat",permission:[],enable:!0,menu_id:"uni-stat-page-content-analysis",name:"内容统计",icon:"admin-icons-doc",url:"",sort:2140,create_date:1638356902516},{parent_id:"uni-stat-page-content-analysis",permission:[],enable:!0,menu_id:"uni-stat-page-content",name:"内容统计",icon:"",url:"/pages/uni-stat/page-content/page-content",sort:2141,create_date:1638356902516},{parent_id:"uni-stat-page-content-analysis",permission:[],enable:!0,menu_id:"uni-stat-page-rule",name:"页面规则",icon:"",url:"/pages/uni-stat/page-rule/page-rule",sort:2142,create_date:1638356902516},{parent_id:"uni-stat",permission:[],enable:!0,menu_id:"uni-stat-senceChannel",name:"渠道/场景值分析",icon:"admin-icons-qudaofenxi",url:"",sort:2150,create_date:1638356902516},{parent_id:"uni-stat-senceChannel",permission:[],enable:!0,menu_id:"uni-stat-senceChannel-scene",name:"场景值（小程序）",icon:"",url:"/pages/uni-stat/scene/scene",sort:2151,create_date:1638356902516},{parent_id:"uni-stat-senceChannel",permission:[],enable:!0,menu_id:"uni-stat-senceChannel-channel",name:"渠道（app）",icon:"",url:"/pages/uni-stat/channel/channel",sort:2152,create_date:1638356902516},{parent_id:"uni-stat",permission:[],enable:!0,menu_id:"uni-stat-event-event",name:"自定义事件",icon:"admin-icons-shijianfenxi",url:"/pages/uni-stat/event/event",sort:2160,create_date:1638356902516},{parent_id:"uni-stat",permission:[],enable:!0,menu_id:"uni-stat-error",name:"错误统计",icon:"admin-icons-cuowutongji",url:"",sort:2170,create_date:1638356902516},{parent_id:"uni-stat-error",permission:[],enable:!0,menu_id:"uni-stat-error-js",name:"js报错",icon:"",url:"/pages/uni-stat/error/js/js",sort:2171,create_date:1638356902516},{parent_id:"uni-stat-error",permission:[],enable:!0,menu_id:"uni-stat-error-app",name:"app崩溃",icon:"",url:"/pages/uni-stat/error/app/app",sort:2172,create_date:1638356902516},{menu_id:"uni-stat-pay",name:"支付统计",icon:"uni-icons-circle",url:"",sort:2122,parent_id:"uni-stat",permission:[],enable:!0,create_date:1667386977981},{menu_id:"uni-stat-pay-overview",name:"概况",icon:"",url:"/pages/uni-stat/pay-order/overview/overview",sort:21221,parent_id:"uni-stat-pay",permission:[],enable:!0,create_date:1667387038602},{menu_id:"uni-stat-pay-funnel",name:"转换漏斗分析",icon:"",url:"/pages/uni-stat/pay-order/funnel/funnel",sort:21222,parent_id:"uni-stat-pay",permission:[],enable:!0,create_date:1668430092890},{menu_id:"uni-stat-pay-ranking",name:"价值用户排行",icon:"",url:"/pages/uni-stat/pay-order/ranking/ranking",sort:21223,parent_id:"uni-stat-pay",permission:[],enable:!0,create_date:1668430128302},{menu_id:"uni-stat-pay-order-list",name:"订单明细",icon:"",url:"/pages/uni-stat/pay-order/list/list",sort:21224,parent_id:"uni-stat-pay",permission:[],enable:!0,create_date:1667387078947}],i=e.er.database(),a=[];function s(e,n,t=0){return e.forEach((i=>{i.menu_id===n&&i.parent_id&&(t=t+1+s(e,i.parent_id,t))})),t}function r(e,n,t=[]){return e.find((e=>e.parent_id===n))&&e.forEach((i=>{i.parent_id===n&&(t.push(i._id),r(e,i.menu_id,t))})),t}const o={data:()=>({query:"",where:"",orderby:"create_date asc",options:{pageSize:2e4,pageCurrent:1},selectedIndexs:[],loading:!0,menus:[],errMsg:"",currentTab:"menus",selectedPluginMenuIndexs:[]}),computed:{pluginMenus(){const e=[];if(!this.$hasRole("admin"))return e;const n=this.menus;return n.length?(a.forEach((t=>{n.find((e=>e.menu_id===t.menu_id))||e.push(t)})),e):e}},watch:{pluginMenus(e){e.length||(this.currentTab="menus")}},methods:{enableChange(e){e.enable=!e.enable,i.collection("opendb-admin-menus").doc(e._id).update({enable:e.enable})},getSortMenu:e=>(e.map((n=>{e.some((e=>e.parent_id===n.menu_id))||(n.isLeafNode=!0)})),n.buildMenus(e)),onqueryload(e){for(let i=0;i<e.length;i++){let n=e[i];const t=s(e,n.menu_id);n.name=(t?"　".repeat(t)+"|-":"")+n.name}const n=this.getSortMenu(e),t=[];this.patTree(n,t),e.length=0,e.push(...t),this.menus=e},patTree(e,n){return e.forEach((e=>{n.push(e),e.children.length&&this.patTree(e.children,n)})),n},switchTab(e){this.currentTab=e},loadData(e=!0){this.$refs.udb.loadData({clear:e})},navigateTo(n,t){e.index.navigateTo({url:n,events:{refreshData:()=>{this.loadData(t)}}})},confirmDelete(n){let t=n._id,i="是否删除该菜单？";const a=r(this.menus,n.menu_id);a.length&&(i="是否删除该菜单及其子菜单？"),t=[t,...a],e.index.showModal({title:"提示",content:i,success:e=>{e.confirm&&this.$refs.udb.remove(t,{needConfirm:!1})}})},pluginMenuSelectChange(e){this.selectedPluginMenuIndexs=e.detail.index},addPluginMenus(n){if(!this.selectedPluginMenuIndexs.length)return e.index.showModal({title:"提示",content:"请选择要添加的菜单！",showCancel:!1});const t=this.pluginMenus,i=[];this.selectedPluginMenuIndexs.forEach((e=>{const n=t[e];if(n){const e=JSON.parse(JSON.stringify(n));e.enable=!0,delete e.json,i.push(e)}})),e.index.showModal({title:"提示",content:"您确认要添加已选中的菜单吗？",success:n=>{if(!n.confirm)return;e.index.showLoading({mask:!0});const a=i.length===t.length;e.er.database().collection("opendb-admin-menus").add(i).then((n=>{e.index.showModal({title:"提示",content:"添加菜单成功！",showCancel:!1,success:()=>{this.$refs.pluginMenusTable.clearSelection(),a&&(this.currentTab="menus"),this.loadData()}})})).catch((n=>{e.index.showModal({title:"提示",content:n.message,showCancel:!1})})).finally((()=>{e.index.hideLoading()}))}})},async updateBuiltInMenu(){e.index.showModal({title:"提示",content:"确定更新内置菜单吗？\n（该操作不会影响现有的菜单）",success:async n=>{if(n.confirm){const n=e.er.database(),a=n.command;let s=t.map(((e,n)=>e.menu_id));e.index.showLoading({title:"更新中...",mask:!0});try{let i=[],r=(await n.collection("opendb-admin-menus").where({menu_id:a.in[s]}).limit(500).get()).result.data;if(t.map(((e,n)=>{r.find(((n,t,i)=>n.menu_id===e.menu_id))||i.push({...e,create_date:void 0})})),i&&i.length>0){let t=await n.collection("opendb-admin-menus").add(i);e.index.showToast({title:`新增了${t.result.inserted}个菜单，即将刷新`,icon:"none"}),setTimeout((()=>{this.loadData(!0)}),300)}else e.index.showToast({title:"菜单无变动",icon:"none"})}catch(i){console.error(i)}finally{e.index.hideLoading()}}}})}}};if(!Array){(e.resolveComponent("uni-stat-breadcrumb")+e.resolveComponent("uni-badge")+e.resolveComponent("uni-th")+e.resolveComponent("uni-tr")+e.resolveComponent("uni-td")+e.resolveComponent("uni-table")+e.resolveComponent("unicloud-db")+e.resolveComponent("fix-window"))()}Math||((()=>"../../../components/uni-stat-breadcrumb/uni-stat-breadcrumb.js")+(()=>"../../../uni_modules/uni-badge/components/uni-badge/uni-badge.js")+(()=>"../../../uni_modules/uni-table/components/uni-th/uni-th.js")+(()=>"../../../uni_modules/uni-table/components/uni-tr/uni-tr.js")+(()=>"../../../uni_modules/uni-table/components/uni-td/uni-td.js")+(()=>"../../../uni_modules/uni-table/components/uni-table/uni-table.js")+(()=>"../../../node-modules/@dcloudio/uni-components/lib/unicloud-db/unicloud-db.js")+(()=>"../../../components/fix-window/fix-window.js"))();const u=e._export_sfc(o,[["render",function(n,t,i,a,s,r){return e.e({a:e.t(n.$t("menu.text.menuManager")),b:e.o((e=>r.switchTab("menus"))),c:"menus"===s.currentTab?1:"",d:r.pluginMenus.length},r.pluginMenus.length?{e:e.t(n.$t("menu.text.additiveMenu")),f:e.p({text:r.pluginMenus.length,type:"error"}),g:e.o((e=>r.switchTab("pluginMenus"))),h:"pluginMenus"===s.currentTab?1:""}:{},{i:e.t(n.$t("menu.button.addFirstLevelMenu")),j:e.o((e=>r.navigateTo("./add"))),k:e.t(n.$t("menu.button.updateBuiltInMenu")),l:e.o(((...e)=>r.updateBuiltInMenu&&r.updateBuiltInMenu(...e))),m:e.w((({data:t,pagination:i,loading:a,error:o},u,d)=>({a:"f65b32c6-5-"+d+",f65b32c6-4-"+d,b:"f65b32c6-6-"+d+",f65b32c6-4-"+d,c:"f65b32c6-7-"+d+",f65b32c6-4-"+d,d:"f65b32c6-8-"+d+",f65b32c6-4-"+d,e:"f65b32c6-9-"+d+",f65b32c6-4-"+d,f:"f65b32c6-10-"+d+",f65b32c6-4-"+d,g:"f65b32c6-4-"+d+",f65b32c6-3-"+d,h:e.f(t,((t,i,a)=>e.e({a:e.t(t.sort),b:"f65b32c6-12-"+d+"-"+a+",f65b32c6-11-"+d+"-"+a,c:e.t(t.name),d:"f65b32c6-13-"+d+"-"+a+",f65b32c6-11-"+d+"-"+a,e:e.t(t.menu_id),f:"f65b32c6-14-"+d+"-"+a+",f65b32c6-11-"+d+"-"+a,g:e.t(t.url),h:"f65b32c6-15-"+d+"-"+a+",f65b32c6-11-"+d+"-"+a,i:t.enable,j:e.o((e=>r.enableChange(t)),i),k:t.enable?"":1,l:"f65b32c6-16-"+d+"-"+a+",f65b32c6-11-"+d+"-"+a,m:e.o((e=>r.navigateTo("./edit?id="+t._id,!1)),i),n:"system_menu"!==t.menu_id&&"system_management"!==t.menu_id},"system_menu"!==t.menu_id&&"system_management"!==t.menu_id?{o:e.t(n.$t("common.button.delete")),p:e.o((e=>r.confirmDelete(t)),i)}:{},{q:!t.url},t.url?{}:{r:e.t(n.$t("menu.button.addChildMenu")),s:e.o((e=>r.navigateTo("./add?parent_id="+t.menu_id,!1)),i)},{t:"f65b32c6-17-"+d+"-"+a+",f65b32c6-11-"+d+"-"+a,v:i,w:"f65b32c6-11-"+d+"-"+a+",f65b32c6-3-"+d}))),i:"f65b32c6-3-"+d+",f65b32c6-2",j:e.p({loading:a,emptyText:s.errMsg||n.$t("common.empty"),border:!0,stripe:!0}),k:d,l:u})),{name:"d",path:"m",vueId:"f65b32c6-2"}),n:e.p({align:"center"}),o:e.p({width:"200",align:"center"}),p:e.p({align:"center"}),q:e.p({align:"center"}),r:e.p({width:"100",align:"center"}),s:e.p({align:"center"}),t:e.p({align:"center"}),v:e.p({align:"center"}),w:e.t(n.$t("common.button.edit")),x:e.p({align:"center"}),y:e.sr("udb","f65b32c6-2"),z:e.o(r.onqueryload),A:e.p({collection:"opendb-admin-menus",options:s.options,where:s.where,"page-data":"replace",orderby:s.orderby,getcount:!0,"page-size":s.options.pageSize,"page-current":s.options.pageCurrent}),B:"menus"===s.currentTab,C:e.o(((...e)=>r.addPluginMenus&&r.addPluginMenus(...e))),D:e.p({align:"center"}),E:e.p({align:"center"}),F:e.p({align:"center"}),G:e.f(r.pluginMenus,((n,t,i)=>({a:e.t(n.name),b:e.t(n.menu_id),c:"f65b32c6-24-"+i+",f65b32c6-23-"+i,d:e.t(n.url),e:"f65b32c6-25-"+i+",f65b32c6-23-"+i,f:e.t(n.json),g:"f65b32c6-26-"+i+",f65b32c6-23-"+i,h:t,i:"f65b32c6-23-"+i+",f65b32c6-18"}))),H:e.sr("pluginMenusTable","f65b32c6-18"),I:e.o(r.pluginMenuSelectChange),J:e.p({type:"selection",border:!0,stripe:!0}),K:"pluginMenus"===s.currentTab})}]]);wx.createPage(u);
