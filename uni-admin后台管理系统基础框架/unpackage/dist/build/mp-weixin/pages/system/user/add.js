"use strict";const e=require("../../../common/vendor.js"),a=require("../../../js_sdk/validator/uni-id-users.js"),o=e.er.database();function t(e){let o={};for(let t in a.validator)e.includes(t)&&(o[t]=a.validator[t]);return o}o.command;const l={data:()=>({formData:{username:"",nickname:"",password:"",role:[],authorizedApp:[],tags:[],mobile:void 0,email:void 0,status:!0},rules:{...t(["username","password","role","mobile","email"]),status:{rules:[{format:"bool"}]}},roles:[]}),onLoad(){this.loadroles()},methods:{gotoAppList(){e.index.navigateTo({url:"../app/list"})},gotoTagList(){e.index.navigateTo({url:"../tag/list"})},gotoTagAdd(){e.index.navigateTo({url:"../tag/add",events:{refreshCheckboxData:()=>{this.$refs.checkbox.loadData()}}})},submitForm(){this.$refs.form.submit()},submit(a){const{value:o,errors:t}=a.detail;t||(e.index.showLoading({title:"提交中...",mask:!0}),"boolean"==typeof o.status&&(o.status=Number(!o.status)),this.$request("addUser",o).then((()=>{e.index.showToast({title:"新增成功"}),this.getOpenerEventChannel().emit("refreshData"),setTimeout((()=>e.index.navigateBack()),500)})).catch((a=>{e.index.showModal({content:a.message||"请求服务失败",showCancel:!1})})).finally((a=>{e.index.hideLoading()})))},loadroles(){o.collection("uni-id-roles").limit(500).get().then((e=>{const a=[];this.roles=e.result.data.map((e=>(a.push(e.role_id),{value:e.role_id,text:e.role_name}))),-1===a.indexOf("admin")&&this.roles.unshift({value:"admin",text:"超级管理员"})})).catch((a=>{e.index.showModal({title:"提示",content:a.message,showCancel:!1})}))}}};if(!Array){(e.resolveComponent("uni-easyinput")+e.resolveComponent("uni-forms-item")+e.resolveComponent("uni-data-checkbox")+e.resolveComponent("uni-forms"))()}Math||((()=>"../../../uni_modules/uni-easyinput/components/uni-easyinput/uni-easyinput.js")+(()=>"../../../uni_modules/uni-forms/components/uni-forms-item/uni-forms-item.js")+(()=>"../../../uni_modules/uni-data-checkbox/components/uni-data-checkbox/uni-data-checkbox.js")+(()=>"../../../uni_modules/uni-forms/components/uni-forms/uni-forms.js"))();const s=e._export_sfc(l,[["render",function(a,o,t,l,s,i){return{a:e.o((e=>s.formData.username=e)),b:e.p({clearable:!1,placeholder:"请输入用户名",modelValue:s.formData.username}),c:e.p({name:"username",label:"用户名",required:!0}),d:e.o((e=>s.formData.nickname=e)),e:e.p({clearable:!1,placeholder:"请输入用户昵称",modelValue:s.formData.nickname}),f:e.p({name:"nickname",label:"用户昵称",required:!0}),g:e.o((e=>s.formData.password=e)),h:e.p({clearable:!1,placeholder:"请输入初始密码",modelValue:s.formData.password}),i:e.p({name:"password",label:"初始密码",required:!0}),j:e.o((e=>s.formData.role=e)),k:e.p({multiple:!0,localdata:s.roles,modelValue:s.formData.role}),l:e.p({name:"role",label:"角色列表"}),m:e.sr("checkbox","4ff9b1de-10,4ff9b1de-9"),n:e.o((e=>s.formData.tags=e)),o:e.p({multiple:!0,collection:"uni-id-tag",field:"tagid as value, name as text",modelValue:s.formData.tags}),p:e.o(((...e)=>i.gotoTagAdd&&i.gotoTagAdd(...e))),q:e.o(((...e)=>i.gotoTagList&&i.gotoTagList(...e))),r:e.p({name:"tags",label:"用户标签",labelWidth:"100"}),s:e.o((e=>s.formData.authorizedApp=e)),t:e.p({multiple:!0,collection:"opendb-app-list",field:"appid as value, name as text",modelValue:s.formData.authorizedApp}),v:e.o(((...e)=>i.gotoAppList&&i.gotoAppList(...e))),w:e.p({name:"authorizedApp",label:"可登录应用",labelWidth:"100"}),x:e.o((e=>s.formData.mobile=e)),y:e.p({clearable:!1,placeholder:"请输入手机号",modelValue:s.formData.mobile}),z:e.p({name:"mobile",label:"手机号"}),A:e.o((e=>s.formData.email=e)),B:e.p({clearable:!1,placeholder:"请输入邮箱",modelValue:s.formData.email}),C:e.p({name:"email",label:"邮箱"}),D:e.o((e=>a.binddata("status",e.detail.value))),E:s.formData.status,F:e.p({name:"status",label:"是否启用"}),G:e.t(a.$t("common.button.submit")),H:e.o(((...e)=>i.submitForm&&i.submitForm(...e))),I:e.t(a.$t("common.button.back")),J:e.sr("form","4ff9b1de-0"),K:e.o(i.submit),L:e.o((e=>s.formData=e)),M:e.p({rules:s.rules,validateTrigger:"bind",modelValue:s.formData})}}]]);wx.createPage(s);
