"use strict";const e=require("../../../common/vendor.js"),t=require("../../../js_sdk/validator/uni-id-roles.js"),n=e.er.database(),o=["role_id","role_name","permission.permission_name"],i={ascending:"asc",descending:"desc"},a={data:()=>({collectionList:[n.collection("uni-id-roles").field("comment,permission,role_id,role_name,create_date").getTemp(),n.collection("uni-id-permissions").field("permission_name, permission_id").getTemp()],query:"",where:"",orderby:"create_date desc",orderByFieldName:"",selectedIndexs:[],options:{pageSize:20,pageCurrent:1,filterData:{},...t.enumConverter},imageStyles:{width:64,height:64},exportExcel:{filename:"uni-id-roles.xls",type:"xls",fields:{"唯一ID":"role_id","名称":"role_name","权限":"permission","备注":"comment",create_date:"create_date"}},exportExcelData:[]}),onLoad(){this._filter={}},onReady(){this.$refs.udb.loadData()},methods:{onqueryload(e){for(let t=0;t<e.length;t++){let n=e[t];n.permission=n.permission.map((e=>e.permission_name)).join("、"),n.create_date=this.$formatDate(n.create_date)}this.exportExcelData=e},changeSize(e){this.options.pageSize=e,this.options.pageCurrent=1,this.$nextTick((()=>{this.loadData()}))},getWhere(){const e=this.query.trim();if(!e)return"";const t=new RegExp(e,"i");return o.map((e=>t+".test("+e+")")).join(" || ")},search(){const e=this.getWhere();this.where=e,this.$nextTick((()=>{this.loadData()}))},loadData(e=!0){this.$refs.udb.loadData({clear:e})},onPageChanged(e){this.selectedIndexs.length=0,this.$refs.table.clearSelection(),this.$refs.udb.loadData({current:e.current})},navigateTo(t,n){e.index.navigateTo({url:t,events:{refreshData:()=>{this.loadData(n)}}})},selectedItems(){let e=this.$refs.udb.dataList;return this.selectedIndexs.map((t=>e[t]._id))},delTable(){this.$refs.udb.remove(this.selectedItems(),{success:e=>{this.$refs.table.clearSelection()}})},selectionChange(e){this.selectedIndexs=e.detail.index},confirmDelete(e){this.$refs.udb.remove(e,{success:e=>{this.$refs.table.clearSelection()}})},sortChange(e,t){this.orderByFieldName=t,e.order?this.orderby=t+" "+i[e.order]:this.orderby="",this.$refs.table.clearSelection(),this.$nextTick((()=>{this.$refs.udb.loadData()}))},filterChange(e,o){this._filter[o]={type:e.filterType,value:e.filter};let i=t.filterToWhere(this._filter,n.command);Object.keys(i).length?this.where=i:this.where="",this.$nextTick((()=>{this.$refs.udb.loadData()}))}}};if(!Array){(e.resolveComponent("uni-stat-breadcrumb")+e.resolveComponent("uni-th")+e.resolveComponent("uni-tr")+e.resolveComponent("uni-td")+e.resolveComponent("uni-dateformat")+e.resolveComponent("uni-table")+e.resolveComponent("uni-pagination")+e.resolveComponent("unicloud-db")+e.resolveComponent("fix-window"))()}Math||((()=>"../../../components/uni-stat-breadcrumb/uni-stat-breadcrumb.js")+(()=>"../../../uni_modules/uni-table/components/uni-th/uni-th.js")+(()=>"../../../uni_modules/uni-table/components/uni-tr/uni-tr.js")+(()=>"../../../uni_modules/uni-table/components/uni-td/uni-td.js")+(()=>"../../../uni_modules/uni-dateformat/components/uni-dateformat/uni-dateformat.js")+(()=>"../../../uni_modules/uni-table/components/uni-table/uni-table.js")+(()=>"../../../uni_modules/uni-pagination/components/uni-pagination/uni-pagination.js")+(()=>"../../../node-modules/@dcloudio/uni-components/lib/unicloud-db/unicloud-db.js")+(()=>"../../../components/fix-window/fix-window.js"))();const r=e._export_sfc(a,[["render",function(t,n,o,i,a,r){return{a:e.o(((...e)=>r.search&&r.search(...e))),b:t.$t("common.placeholder.query"),c:a.query,d:e.o((e=>a.query=e.detail.value)),e:e.t(t.$t("common.button.search")),f:e.o(((...e)=>r.search&&r.search(...e))),g:e.t(t.$t("common.button.add")),h:e.o((e=>r.navigateTo("./add"))),i:e.t(t.$t("common.button.batchDelete")),j:!a.selectedIndexs.length,k:e.o(((...e)=>r.delTable&&r.delTable(...e))),l:e.w((({data:n,pagination:o,loading:i,error:a,options:s},l,d)=>({a:"0bf18566-4-"+d+",0bf18566-3-"+d,b:"0bf18566-5-"+d+",0bf18566-3-"+d,c:"0bf18566-6-"+d+",0bf18566-3-"+d,d:"0bf18566-7-"+d+",0bf18566-3-"+d,e:"0bf18566-8-"+d+",0bf18566-3-"+d,f:"0bf18566-9-"+d+",0bf18566-3-"+d,g:"0bf18566-3-"+d+",0bf18566-2-"+d,h:e.f(n,((t,n,o)=>({a:e.t(t.role_id),b:"0bf18566-11-"+d+"-"+o+",0bf18566-10-"+d+"-"+o,c:e.t(t.role_name),d:"0bf18566-12-"+d+"-"+o+",0bf18566-10-"+d+"-"+o,e:e.t(t.permission),f:"0bf18566-13-"+d+"-"+o+",0bf18566-10-"+d+"-"+o,g:e.t(t.comment),h:"0bf18566-14-"+d+"-"+o+",0bf18566-10-"+d+"-"+o,i:"0bf18566-16-"+d+"-"+o+",0bf18566-15-"+d+"-"+o,j:e.p({threshold:[0,0],date:t.create_date}),k:"0bf18566-15-"+d+"-"+o+",0bf18566-10-"+d+"-"+o,l:e.o((e=>r.navigateTo("./edit?id="+t._id,!1)),n),m:e.o((e=>r.confirmDelete(t._id)),n),n:"0bf18566-17-"+d+"-"+o+",0bf18566-10-"+d+"-"+o,o:n,p:"0bf18566-10-"+d+"-"+o+",0bf18566-2-"+d}))),i:e.sr("table","0bf18566-2-"+d+",0bf18566-1"),j:"0bf18566-2-"+d+",0bf18566-1",k:e.p({loading:i,emptyText:a.message||t.$t("common.empty"),border:!0,stripe:!0,type:"selection"}),l:"0bf18566-18-"+d+",0bf18566-1",m:e.o((e=>o.current=e)),n:e.p({"show-icon":!0,"show-page-size":!0,"page-size":o.size,total:o.count,modelValue:o.current}),o:d,p:l})),{name:"d",path:"l",vueId:"0bf18566-1"}),m:e.o((e=>r.filterChange(e,"role_id"))),n:e.o((e=>r.sortChange(e,"role_id"))),o:e.p({align:"center","filter-type":"search",sortable:!0}),p:e.o((e=>r.filterChange(e,"role_name"))),q:e.o((e=>r.sortChange(e,"role_name"))),r:e.p({align:"center","filter-type":"search",sortable:!0}),s:e.p({align:"center"}),t:e.o((e=>r.filterChange(e,"comment"))),v:e.o((e=>r.sortChange(e,"comment"))),w:e.p({align:"center","filter-type":"search",sortable:!0}),x:e.o((e=>r.filterChange(e,"create_date"))),y:e.o((e=>r.sortChange(e,"create_date"))),z:e.p({align:"center","filter-type":"timestamp",sortable:!0}),A:e.p({align:"center"}),B:e.p({align:"center"}),C:e.p({align:"center"}),D:e.p({align:"center"}),E:e.p({align:"center"}),F:e.p({align:"center"}),G:e.t(t.$t("common.button.edit")),H:e.t(t.$t("common.button.delete")),I:e.p({align:"center"}),J:e.o(r.selectionChange),K:e.o(r.onPageChanged),L:e.o(r.changeSize),M:e.sr("udb","0bf18566-1"),N:e.o(r.onqueryload),O:e.p({collection:a.collectionList,where:a.where,"page-data":"replace",orderby:a.orderby,getcount:!0,"page-size":a.options.pageSize,"page-current":a.options.pageCurrent,options:a.options,loadtime:"manual"})}}]]);wx.createPage(r);
