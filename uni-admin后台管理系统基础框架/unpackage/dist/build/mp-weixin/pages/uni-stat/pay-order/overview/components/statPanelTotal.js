"use strict";const t=require("../../../../../common/vendor.js"),e=require("../../../../../js_sdk/uni-stat/util.js"),a=require("../../../../../js_sdk/uni-stat/timeUtil.js");let n=require("../fieldsMap.js").statPanelTodayFieldsMap;const i={props:{query:{type:[Object],default:function(){return{}}}},data:()=>({tableName:"uni-stat-pay-result",fieldsMap:n,panelData:{today:{pay_total_amount:"-",pay_order_count:"-"},yesterday:{pay_total_amount:"-",pay_order_count:"-"},beforeyesterday:{pay_total_amount:"-",pay_order_count:"-"},week:{pay_total_amount:"-",pay_order_count:"-"},month:{pay_total_amount:"-",pay_order_count:"-"},quarter:{pay_total_amount:"-",pay_order_count:"-"},year:{pay_total_amount:"-",pay_order_count:"-"},total:{pay_total_amount:"-",pay_order_count:"-"}},loading:!1}),created(){this.getCloudDataDebounce=e.debounce((()=>{this.getCloudData()}),300),this.getCloudDataDebounce()},methods:{getCloudData(){let a=this.query;if(!a.appid)return;this.loading=!0,a=e.stringifyQuery(a,!0,["uni_platform"]);let i=this.getWhere(a);a&&(i=`${a} && (${i})`);const o=t.er.database();o.collection(this.tableName).where(i).field(`${e.stringifyField(n)}, dimension, stat_date.date_str as stat_time, start_time`).groupBy("stat_time, dimension").groupField(e.stringifyGroupField(n)+",last(start_time) as start_time").get().then((t=>{let a=t.result.data;a.map(((t,e)=>{t.actual_total_amount||(t.actual_total_amount=t.pay_total_amount-t.refund_total_amount)})),a=e.formatterData({fieldsMap:n,data:a}),this.loading=!1,Object.assign(this.panelData,this.setPanelData(a))}));let r=`${a} && dimension == "year"`;o.collection(this.tableName).where(r).field(`${e.stringifyField(n)}, dimension`).groupBy("dimension").groupField(e.stringifyGroupField(n)).get().then((t=>{let a=t.result.data;a.map(((t,e)=>{t.actual_total_amount=t.pay_total_amount-t.refund_total_amount})),a=e.formatterData({fieldsMap:n,data:a}),Object.assign(this.panelData,{total:a[0]||{pay_total_amount:0,pay_order_count:0,create_total_amount:0,refund_total_amount:0,actual_total_amount:0}})}))},getWhere(t){let e,n=Date.now(),i=a.timeUtil.getOffsetStartAndEnd("day",0,n),o=a.timeUtil.getOffsetStartAndEnd("day",-1,n),r=a.timeUtil.getOffsetStartAndEnd("day",-2,n),d=a.timeUtil.getOffsetStartAndEnd("week",0,n),l=a.timeUtil.getOffsetStartAndEnd("month",0,n),s=a.timeUtil.getOffsetStartAndEnd("quarter",0,n),m=a.timeUtil.getOffsetStartAndEnd("year",0,n);return e=`(dimension=="day" && start_time==${i.startTime} && end_time==${i.endTime}) || (dimension=="day" && start_time==${o.startTime} && end_time==${o.endTime}) || (dimension=="day" && start_time==${r.startTime} && end_time==${r.endTime}) || (dimension=="week" && start_time==${d.startTime} && end_time==${d.endTime}) || (dimension=="month" && start_time==${l.startTime} && end_time==${l.endTime}) || (dimension=="quarter" && start_time==${s.startTime} && end_time==${s.endTime}) || (dimension=="year" && start_time==${m.startTime} && end_time==${m.endTime})`,e},setPanelData(t){let e=Date.now(),n=a.timeUtil.getOffsetStartAndEnd("day",0,e),i=a.timeUtil.getOffsetStartAndEnd("day",-1,e),o=a.timeUtil.getOffsetStartAndEnd("day",-2,e),r={pay_total_amount:0,pay_order_count:0,create_total_amount:0,refund_total_amount:0,actual_total_amount:0};return{today:t.find((t=>"day"===t.dimension&&t.start_time===n.startTime))||r,yesterday:t.find((t=>"day"===t.dimension&&t.start_time===i.startTime))||r,beforeyesterday:t.find((t=>"day"===t.dimension&&t.start_time===o.startTime))||r,week:t.find((t=>"week"===t.dimension))||r,month:t.find((t=>"month"===t.dimension))||r,quarter:t.find((t=>"quarter"===t.dimension))||r,year:t.find((t=>"year"===t.dimension))||r}}},watch:{query:{deep:!0,handler(t){this.getCloudDataDebounce()}}}};if(!Array){(t.resolveComponent("uni-th")+t.resolveComponent("uni-tr")+t.resolveComponent("uni-icons")+t.resolveComponent("uni-tooltip")+t.resolveComponent("uni-td")+t.resolveComponent("uni-table"))()}Math||((()=>"../../../../../uni_modules/uni-table/components/uni-th/uni-th.js")+(()=>"../../../../../uni_modules/uni-table/components/uni-tr/uni-tr.js")+(()=>"../../../../../uni_modules/uni-icons/components/uni-icons/uni-icons.js")+(()=>"../../../../../uni_modules/uni-tooltip/components/uni-tooltip/uni-tooltip.js")+(()=>"../../../../../uni_modules/uni-table/components/uni-td/uni-td.js")+(()=>"../../../../../uni_modules/uni-table/components/uni-table/uni-table.js"))();const o=t._export_sfc(i,[["render",function(e,a,n,i,o,r){return{a:t.p({align:"center"}),b:t.p({align:"center"}),c:t.p({align:"center"}),d:t.p({align:"center"}),e:t.p({align:"center"}),f:t.p({align:"center"}),g:t.p({align:"center"}),h:t.p({align:"center"}),i:t.p({align:"center"}),j:t.f(o.fieldsMap,((e,a,n)=>t.e({a:t.t(e.title),b:"9f2e867a-14-"+n+",9f2e867a-13-"+n,c:e.tooltip},e.tooltip?{d:t.t(e.tooltip)}:{},{e:"9f2e867a-13-"+n+",9f2e867a-12-"+n,f:"9f2e867a-12-"+n+",9f2e867a-11-"+n,g:t.t(o.panelData.today[e.field]),h:"9f2e867a-15-"+n+",9f2e867a-11-"+n,i:t.t(o.panelData.yesterday[e.field]),j:"9f2e867a-16-"+n+",9f2e867a-11-"+n,k:t.t(o.panelData.beforeyesterday[e.field]),l:"9f2e867a-17-"+n+",9f2e867a-11-"+n,m:t.t(o.panelData.week[e.field]),n:"9f2e867a-18-"+n+",9f2e867a-11-"+n,o:t.t(o.panelData.month[e.field]),p:"9f2e867a-19-"+n+",9f2e867a-11-"+n,q:t.t(o.panelData.quarter[e.field]),r:"9f2e867a-20-"+n+",9f2e867a-11-"+n,s:t.t(o.panelData.year[e.field]),t:"9f2e867a-21-"+n+",9f2e867a-11-"+n,v:t.t(o.panelData.total[e.field]),w:"9f2e867a-22-"+n+",9f2e867a-11-"+n,x:a,y:"9f2e867a-11-"+n+",9f2e867a-0"}))),k:t.p({type:"help",color:"#666"}),l:t.p({align:"center"}),m:t.p({align:"center"}),n:t.p({align:"center"}),o:t.p({align:"center"}),p:t.p({align:"center"}),q:t.p({align:"center"}),r:t.p({align:"center"}),s:t.p({align:"center"}),t:t.p({align:"center"}),v:t.p({loading:o.loading,border:!0,stripe:!0,emptyText:"暂无更多数据"})}}],["__scopeId","data-v-9f2e867a"]]);wx.createComponent(o);
