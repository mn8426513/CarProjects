"use strict";const e=require("../../../common/vendor.js"),a=require("../../../js_sdk/validator/uni-stat-pages.js"),t=e.er.database(),i=["title","path"],d={ascending:"asc",descending:"desc"},o={data:()=>({collectionList:"uni-stat-pages",appid:"",query:"",where:"",orderby:"",orderByFieldName:"",selectedIndexs:[],errorMessage:"",options:{pageSize:20,pageCurrent:1,filterData:{},...a.enumConverter},imageStyles:{width:64,height:64},exportExcel:{filename:"uni-stat-pages.xls",type:"xls",fields:{title:"title",path:"path"}},exportExcelData:[],pageInfo:{_id:"",page_rules:[]},editRulePopup:{loading:!1,tips:"页面规则说明：\n1. 用于生成内容统计 url 的规则。通过设置页面有效参数，通过带参数的 url 对内容进行标识。例如有一个详情页面的请求有三个参数 page/detail/detail?id=1&type=1&t=1565943419，其中 t 为时间戳或随机数，则 id 和 type 为有效参数，需要在页面规则 page/detail/detail 中添加 id,type 这两个参数。\n2. 每条规则可以添加多个参数，进行匹配时，每条规则单独生效。\n3. 每个页面可以添加多个规则（最多 5 个规则），进行匹配时，后添加的规则优先级较高\n4. 目前的匹配规则只能处理通过 url 显式传递参数，且参数形式为上述示例中的键值对格式。",isAddParam:!1,addParamInfo:{index1:"",value:""}}}),onLoad(){this._filter={}},onReady(){this.$refs.appListRef&&(this.appid=this.$refs.appListRef.getCache(),this.search())},methods:{onqueryload(e){this.exportExcelData=e},getWhere(){const e=this.query.trim();let a="";if(e){const t=new RegExp(e,"i");a=i.map((e=>t+".test("+e+")")).join(" || ")}return this.appid&&(a=e?`appid=='${this.appid}' && (${a})`:`appid=='${this.appid}'`),a},search(){this.errorMessage="";const e=this.getWhere();this.where=e,this.$nextTick((()=>{this.loadData()}))},loadData(e=!0){this.$refs.udb.loadData({clear:e})},onPageChanged(e){this.selectedIndexs.length=0,this.$refs.table.clearSelection(),this.$refs.udb.loadData({current:e.current})},navigateTo(a,t){e.index.navigateTo({url:a,events:{refreshData:()=>{this.loadData(t)}}})},sortChange(e,a){this.orderByFieldName=a,e.order?this.orderby=a+" "+d[e.order]:this.orderby="",this.$refs.table.clearSelection(),this.$nextTick((()=>{this.$refs.udb.loadData()}))},filterChange(e,i){this._filter[i]={type:e.filterType,value:e.filter};let d=a.filterToWhere(this._filter,t.command);Object.keys(d).length?this.where=d:this.where="",this.$nextTick((()=>{this.$refs.udb.loadData()}))},editRule(e){this.$refs.editRulePopup.open(),e.page_rules&&e.page_rules.length||(e.page_rules=[[]]),this.pageInfo={_id:e._id,page_rules:JSON.parse(JSON.stringify(e.page_rules))}},addRulesItem(){this.pageInfo.page_rules.unshift([])},deleteRulesItem(e){this.pageInfo.page_rules.splice(e,1)},addParamItem(e){this.editRulePopup.isAddParam=!0,this.editRulePopup.addParamInfo.value="",this.editRulePopup.addParamInfo.index1=e},confirmAddParamItem(e){this.editRulePopup.addParamInfo.value&&this.pageInfo.page_rules[e].push(this.editRulePopup.addParamInfo.value),this.editRulePopup.isAddParam=!1},deleteParamItem(e,a){this.pageInfo.page_rules[e].splice(a,1)},closeEditRulePopup(){this.$refs.editRulePopup.close()},saveRule(){this.editRulePopup.loading=!0;let e=JSON.parse(JSON.stringify(this.pageInfo.page_rules));e=e.filter((e=>e.length>0)),this.$refs.udb.update(this.pageInfo._id,{page_rules:e},{showToast:!1,needLoading:!1,success:()=>{this.$refs.udb.dataList.forEach((a=>{a._id===this.pageInfo._id&&(a.page_rules=e)})),this.closeEditRulePopup()},complete:()=>{this.editRulePopup.loading=!1}})}}};if(!Array){(e.resolveComponent("uni-stat-breadcrumb")+e.resolveComponent("uni-data-select")+e.resolveComponent("uni-th")+e.resolveComponent("uni-tr")+e.resolveComponent("uni-td")+e.resolveComponent("uni-table")+e.resolveComponent("uni-pagination")+e.resolveComponent("unicloud-db")+e.resolveComponent("uni-notice-bar")+e.resolveComponent("uni-icons")+e.resolveComponent("uni-popup"))()}Math||((()=>"../../../components/uni-stat-breadcrumb/uni-stat-breadcrumb.js")+(()=>"../../../uni_modules/uni-data-select/components/uni-data-select/uni-data-select.js")+(()=>"../../../uni_modules/uni-table/components/uni-th/uni-th.js")+(()=>"../../../uni_modules/uni-table/components/uni-tr/uni-tr.js")+(()=>"../../../uni_modules/uni-table/components/uni-td/uni-td.js")+(()=>"../../../uni_modules/uni-table/components/uni-table/uni-table.js")+(()=>"../../../uni_modules/uni-pagination/components/uni-pagination/uni-pagination.js")+(()=>"../../../node-modules/@dcloudio/uni-components/lib/unicloud-db/unicloud-db.js")+(()=>"../../../uni_modules/uni-notice-bar/components/uni-notice-bar/uni-notice-bar.js")+(()=>"../../../uni_modules/uni-icons/components/uni-icons/uni-icons.js")+(()=>"../../../uni_modules/uni-popup/components/uni-popup/uni-popup.js"))();const n=e._export_sfc(o,[["render",function(a,t,i,d,o,n){return{a:e.o(((...e)=>n.search&&n.search(...e))),b:o.query,c:e.o((e=>o.query=e.detail.value)),d:e.o(((...e)=>n.search&&n.search(...e))),e:e.sr("appListRef","abddef4f-1"),f:e.o(n.search),g:e.o((e=>o.appid=e)),h:e.p({collection:"opendb-app-list",field:"appid as value, name as text",orderby:"text asc",label:"应用选择",modelValue:o.appid}),i:e.w((({data:a,pagination:t,loading:i,error:d,options:s},p,l)=>({a:"abddef4f-5-"+l+",abddef4f-4-"+l,b:"abddef4f-6-"+l+",abddef4f-4-"+l,c:"abddef4f-7-"+l+",abddef4f-4-"+l,d:"abddef4f-8-"+l+",abddef4f-4-"+l,e:"abddef4f-9-"+l+",abddef4f-4-"+l,f:"abddef4f-4-"+l+",abddef4f-3-"+l,g:e.f(a,((a,i,d)=>({a:e.t((t.current-1)*t.size+(i+1)),b:"abddef4f-11-"+l+"-"+d+",abddef4f-10-"+l+"-"+d,c:e.t(a.title),d:"abddef4f-12-"+l+"-"+d+",abddef4f-10-"+l+"-"+d,e:e.t(a.path),f:"abddef4f-13-"+l+"-"+d+",abddef4f-10-"+l+"-"+d,g:e.t(a.appid),h:"abddef4f-14-"+l+"-"+d+",abddef4f-10-"+l+"-"+d,i:e.o((e=>n.editRule(a)),i),j:"abddef4f-15-"+l+"-"+d+",abddef4f-10-"+l+"-"+d,k:i,l:"abddef4f-10-"+l+"-"+d+",abddef4f-3-"+l}))),h:e.sr("table","abddef4f-3-"+l+",abddef4f-2"),i:"abddef4f-3-"+l+",abddef4f-2",j:e.p({loading:i,emptyText:o.errorMessage||d.message||"没有更多数据",border:!0,stripe:!0}),k:"abddef4f-16-"+l+",abddef4f-2",l:e.o((e=>t.current=e)),m:e.p({"show-icon":!0,"page-size":t.size,total:t.count,modelValue:t.current}),n:l,o:p})),{name:"d",path:"i",vueId:"abddef4f-2"}),j:e.p({align:"center"}),k:e.o((e=>n.filterChange(e,"title"))),l:e.p({align:"center","filter-type":"search"}),m:e.o((e=>n.filterChange(e,"path"))),n:e.p({align:"left","filter-type":"search"}),o:e.o((e=>n.filterChange(e,"appid"))),p:e.p({align:"center","filter-type":"search"}),q:e.p({align:"center"}),r:e.p({align:"center"}),s:e.p({align:"center"}),t:e.p({align:"left"}),v:e.p({align:"center"}),w:e.p({align:"center"}),x:e.o(n.onPageChanged),y:e.sr("udb","abddef4f-2"),z:e.o(n.onqueryload),A:e.p({collection:o.collectionList,field:"title,path,page_rules,appid",where:o.where,"page-data":"replace",orderby:o.orderby,getcount:!0,"page-size":o.options.pageSize,"page-current":o.options.pageCurrent,options:o.options,loadtime:"manual"}),B:e.p({"font-size":12,text:o.editRulePopup.tips}),C:e.f(o.pageInfo.page_rules,((a,t,i)=>e.e({a:e.t(o.pageInfo.page_rules.length-t),b:e.f(a,((a,d,o)=>({a:e.t(a),b:e.o((e=>n.deleteParamItem(t,d)),d),c:"abddef4f-19-"+i+"-"+o+",abddef4f-17",d:d}))),c:o.editRulePopup.addParamInfo.index1===t&&o.editRulePopup.isAddParam},o.editRulePopup.addParamInfo.index1===t&&o.editRulePopup.isAddParam?{d:o.editRulePopup.addParamInfo.index1===t&&o.editRulePopup.isAddParam,e:e.o((e=>n.confirmAddParamItem(t)),t),f:o.editRulePopup.addParamInfo.value,g:e.o(e.m((e=>o.editRulePopup.addParamInfo.value=e.detail.value),{trim:!0}),t)}:{h:e.o((e=>n.addParamItem(t)),t)},{i:0===t&&o.pageInfo.page_rules.length<5},0===t&&o.pageInfo.page_rules.length<5?{j:e.o(n.addRulesItem,t),k:"abddef4f-20-"+i+",abddef4f-17",l:e.p({type:"plus",size:"28",color:"#606266"})}:{m:e.o((e=>n.deleteRulesItem(t)),t),n:"abddef4f-21-"+i+",abddef4f-17",o:e.p({type:"minus",size:"28",color:"#606266"})},{p:t}))),D:e.p({type:"closeempty",size:"12",color:"#42b983"}),E:o.editRulePopup.loading,F:o.editRulePopup.loading,G:e.o(((...e)=>n.saveRule&&n.saveRule(...e))),H:e.o(((...e)=>n.closeEditRulePopup&&n.closeEditRulePopup(...e))),I:e.sr("editRulePopup","abddef4f-17"),J:e.p({type:"center"})}}],["__scopeId","data-v-abddef4f"]]);wx.createPage(n);
