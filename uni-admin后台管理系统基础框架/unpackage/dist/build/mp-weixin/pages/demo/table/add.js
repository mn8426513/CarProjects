"use strict";const e=require("../../../common/vendor.js"),o=require("../../../js_sdk/validator/uni-id-users.js"),a=require("../../../uni_modules/uni-id-pages/common/store.js"),s=require("../../../js_sdk/uni-stat/util.js"),t=e.er.database();function i(e){let a={};for(let s in o.validator)e.includes(s)&&(a[s]=o.validator[s]);return a}t.command;const n={computed:{userInfo:()=>a.store.userInfo,realNameStatus(){return this.userInfo.realNameAuth?this.userInfo.realNameAuth.authStatus:0}},data:()=>({formData:{add_date:s.getTimeOfSomeDayAgo(0),goods_pro_date:s.getTimeOfSomeDayAgo(0),goods_alreadKilometer:"",goods_name:"",goods_brand:"",is_best:!1,goods_brand:"",goods_paiLiang:"",goods_bianSuXiang:"",goods_quDongFangShi:"",goods_signatures:[]},goods_signatures:[],imageFile_list:[],rules:{...i(["username","password","role","mobile","email"]),status:{rules:[{format:"bool"}]}},roles:[],imageStyles:{width:64,height:64,border:{radius:"50%"}},listStyles:{border:!0,dividline:!0,borderStyle:{width:1,color:"blue",style:"dashed",radius:2}}}),onLoad(){this.loadSignatures()},methods:{gotoAppList(){e.index.navigateTo({url:"./table"})},gotoTagList(){e.index.navigateTo({url:"../tag/list"})},gotoTagAdd(){e.index.navigateTo({url:"../tag/add",events:{refreshCheckboxData:()=>{this.$refs.checkbox.loadData()}}})},loadSignatures(){t.collection("goods-signatures").limit(500).get().then((e=>{const o=[];this.goods_signatures=e.result.data.map((e=>(o.push(e.signature_id),{value:e.signature_id,text:e.signature_name}))),-1===o.indexOf("best")&&this.roles.unshift({value:"best",text:"精品车"})})).catch((o=>{e.index.showModal({title:"查询商品标签错误",content:o.message,showCancel:!1})}))},submitForm(){this.$refs.form.submit()},submit(o){const{value:a,errors:s}=o.detail;""!==o.detail.value.goods_name?""!==o.detail.value.goods_brand?""!==o.detail.value.goods_alreadKilometer?""!==o.detail.value.is_best?""!==o.detail.value.goods_paiLiang?""!==o.detail.value.goods_bianSuXiang?""!==o.detail.value.goods_quDongFangShi?""!==o.detail.value.add_date?""!==o.detail.value.goods_pro_date?0!==this.imageFile_list.length?""!==this.userInfo.nickname?""!==this.userInfo.mobile?s||(e.index.showLoading({title:"提交中...",mask:!0}),"boolean"==typeof a.is_best&&(a.is_best=Number(!a.is_best),this.formData.is_best=Number(!a.is_best)),this.saveGoodsData({success:o=>{e.index.showToast({title:"新增成功"}),this.gotoAppList()},fail:o=>{e.index.showToast({title:o.result.message||"保存失败",icon:"error"})}})):e.index.showModal({content:"销售员手机号必填",showCancel:!1}):e.index.showModal({content:"销售员姓名必填",showCancel:!1}):e.index.showModal({content:"车辆图片必须上传",showCancel:!1}):e.index.showModal({content:"车辆生产日期必填",showCancel:!1}):e.index.showModal({content:"车辆上架日期必填",showCancel:!1}):e.index.showModal({content:"车辆名称不能为空",showCancel:!1}):e.index.showModal({content:"车辆变速箱必填",showCancel:!1}):e.index.showModal({content:"车辆排量必填",showCancel:!1}):e.index.showModal({content:"车辆是否精品必选",showCancel:!1}):e.index.showModal({content:"车辆公里数必填",showCancel:!1}):e.index.showModal({content:"车辆品牌必填",showCancel:!1}):e.index.showModal({content:"车辆名称必填",showCancel:!1})},upload(){this.$refs.files.upload()},select(e){},progress(e){},success(o){for(let e=0;e<o.tempFiles.length;e++)this.imageFile_list.push(o.tempFiles[e]);e.index.showModal({content:"上传图片成功",showCancel:!1})},fail(o){e.index.showModal({content:"上传失败，请重新上传",showCancel:!1})},async saveGoodsData(o){var a;const{success:s,fail:t}=o;try{const o={add_date:this.formData.add_date,goods_name:this.formData.goods_name,goods_brand:this.formData.goods_brand,goods_pro_date:this.formData.goods_pro_date,goods_alreadKilometer:this.formData.goods_alreadKilometer,status:1,shop_name:this.formData.shop_name,goods_thumb:(null==(a=this.imageFile_list[0])?void 0:a.url)||"",create_date:Date.now(),imageFile_list:JSON.stringify(this.imageFile_list),category_id:"1",comment_count:10,goods_banner_imgs:[],goods_desc:"好车",goods_price:"7.2",goods_sn:"商品ID",goods_paiLiang:this.formData.goods_paiLiang,goods_bianSuXiang:this.formData.goods_bianSuXiang,goods_quDongFangShi:this.formData.goods_quDongFangShi,goods_tip:"精品车",is_alone_sale:!0,is_best:this.formData.is_best,is_hot:!0,is_new:!0,is_on_sale:!0,is_real:!0,keywords:"关键字好车",last_modify_date:Date.now(),month_sell_count:1,remain_count:1,seller_note:"商家备注",shop_name:"品域车行",tag:this.formData.goods_signatures,total_sell_count:1,saler_phone:this.userInfo.mobile,saler_name:this.userInfo.nickname};console.log(o);const i=await e.er.callFunction({name:"saveGoodsData",data:{action:"add",tableName:"opendb-mall-goods",data:o}});console.log(i),console.log(i.header["x-serverless-http-status"]),console.log(i.result.code),console.log(i.success),console.log(i.result.message),i.success&&!i.result.code&&"200"==i.header["x-serverless-http-status"]?setTimeout((()=>{console.log("success_"),s(i),"function"==typeof s&&s(i)}),500):"function"==typeof t&&t(i)}catch(i){"function"==typeof t&&t(result)}}}};if(!Array){(e.resolveComponent("uni-easyinput")+e.resolveComponent("uni-forms-item")+e.resolveComponent("uni-data-checkbox")+e.resolveComponent("uni-datetime-picker")+e.resolveComponent("uni-forms")+e.resolveComponent("uni-card")+e.resolveComponent("uni-file-picker")+e.resolveComponent("uni-section"))()}Math||((()=>"../../../uni_modules/uni-easyinput/components/uni-easyinput/uni-easyinput.js")+(()=>"../../../uni_modules/uni-forms/components/uni-forms-item/uni-forms-item.js")+(()=>"../../../uni_modules/uni-data-checkbox/components/uni-data-checkbox/uni-data-checkbox.js")+(()=>"../../../uni_modules/uni-datetime-picker/components/uni-datetime-picker/uni-datetime-picker.js")+(()=>"../../../uni_modules/uni-forms/components/uni-forms/uni-forms.js")+(()=>"../../../uni_modules/uni-card/components/uni-card/uni-card.js")+(()=>"../../../uni_modules/uni-file-picker/components/uni-file-picker/uni-file-picker.js")+(()=>"../../../uni_modules/uni-section/components/uni-section/uni-section.js"))();const l=e._export_sfc(n,[["render",function(o,a,s,t,i,n){return{a:e.o((e=>i.formData.goods_name=e)),b:e.p({clearable:!1,placeholder:"请输入车辆名称",modelValue:i.formData.goods_name}),c:e.p({name:"goods_name",label:"车辆名称",required:!0}),d:e.o((e=>i.formData.goods_brand=e)),e:e.p({clearable:!1,placeholder:"请输入汽车品牌",modelValue:i.formData.goods_brand}),f:e.p({name:"goods_brand",label:"汽车品牌",required:!0}),g:e.o((e=>i.formData.goods_alreadKilometer=e)),h:e.p({clearable:!1,placeholder:"请输入公里数",modelValue:i.formData.goods_alreadKilometer}),i:e.p({name:"goods_alreadKilometer",label:"公里数",required:!0}),j:e.o((e=>o.binddata("is_best",e.detail.value))),k:i.formData.is_best,l:e.p({name:"is_best",label:"是否精品",required:!0}),m:e.o((e=>i.formData.goods_signatures=e)),n:e.p({multiple:!0,localdata:i.goods_signatures,modelValue:i.formData.goods_signatures}),o:e.p({name:"role",label:"商品标签"}),p:e.o((e=>i.formData.goods_paiLiang=e)),q:e.p({clearable:!1,placeholder:"请输入车辆排量",modelValue:i.formData.goods_paiLiang}),r:e.p({name:"goods_paiLiang",label:"车辆排量",required:!0}),s:e.o((e=>i.formData.goods_bianSuXiang=e)),t:e.p({clearable:!1,placeholder:"请输入变速箱",modelValue:i.formData.goods_bianSuXiang}),v:e.p({name:"goods_bianSuXiang",label:"变速箱",required:!0}),w:e.o((e=>i.formData.goods_quDongFangShi=e)),x:e.p({clearable:!1,placeholder:"请输入驱动方式",modelValue:i.formData.goods_quDongFangShi}),y:e.p({name:"goods_quDongFangShi",label:"驱动方式",required:!0}),z:i.formData.add_date?1:"",A:e.o((e=>i.formData.add_date=e)),B:e.p({type:"date",returnType:"timestamp",clearIcon:!1,modelValue:i.formData.add_date}),C:e.p({name:"add_date",label:"上架日期",required:!0}),D:i.formData.goods_pro_date?1:"",E:e.o((e=>i.formData.goods_pro_date=e)),F:e.p({type:"date",returnType:"timestamp",clearIcon:!1,modelValue:i.formData.goods_pro_date}),G:e.p({name:"goods_pro_date",label:"生产日期",required:!0}),H:e.o((e=>n.userInfo.nickname=e)),I:e.p({clearable:!1,disabled:"true",placeholder:"请输入销售员姓名",modelValue:n.userInfo.nickname}),J:e.p({name:"goods_saler",label:"销售员",required:!0}),K:e.o((e=>n.userInfo.mobile=e)),L:e.p({clearable:!1,disabled:"true",placeholder:"请输入销售员手机号",modelValue:n.userInfo.mobile}),M:e.p({name:"goods_saler_phone",label:"手机号",required:!0}),N:e.sr("form","c86958ba-0"),O:e.o(n.submit),P:e.o((e=>i.formData=e)),Q:e.p({rules:i.rules,validateTrigger:"bind",modelValue:i.formData}),R:e.p({"is-shadow":!1,"is-full":!0}),S:e.sr("files","c86958ba-26,c86958ba-25"),T:e.o(n.select),U:e.o(n.progress),V:e.o(n.success),W:e.o(n.fail),X:e.p({limit:"12",title:"最多选择9张图片","auto-upload":!1,"disable-preview":!1}),Y:e.o(((...e)=>n.upload&&n.upload(...e))),Z:e.p({title:"只选择图片",type:"line"}),aa:e.t(o.$t("common.button.submit")),ab:e.o(((...e)=>n.submitForm&&n.submitForm(...e))),ac:e.t(o.$t("common.button.back"))}}]]);wx.createPage(l);
