"use strict";const e=require("../../../common/vendor.js"),o=require("../../../js_sdk/validator/uni-id-users.js");function s(e){let s={};for(let t in o.validator)e.includes(t)&&(s[t]=o.validator[t]);return s}e.er.database().command;const t={data:()=>({formData:{mall_name:""},imageFile_list:[],rules:{...s(["username","password","role","mobile","email"]),status:{rules:[{format:"bool"}]}},roles:[],imageStyles:{width:64,height:64,border:{radius:"50%"}},listStyles:{border:!0,dividline:!0,borderStyle:{width:1,color:"blue",style:"dashed",radius:2}}}),onLoad(){},methods:{gotoAppList(){e.index.navigateTo({url:"./table"})},gotoTagList(){e.index.navigateTo({url:"../tag/list"})},gotoTagAdd(){e.index.navigateTo({url:"../tag/add",events:{refreshCheckboxData:()=>{this.$refs.checkbox.loadData()}}})},submitForm(){this.$refs.form.submit()},submit(o){const{value:s,errors:t}=o.detail;""!==o.detail.value.goods_name?0!==this.imageFile_list.length?t||(e.index.showLoading({title:"提交中...",mask:!0}),this.saveMallInfoData({success:o=>{e.index.showToast({title:"新增成功，请在手机端查看"})},fail:o=>{e.index.showToast({title:o.result.message||"保存失败",icon:"error"})}})):e.index.showModal({content:"店铺图片必须上传",showCancel:!1}):e.index.showModal({content:"店铺名称必填",showCancel:!1})},upload(){this.$refs.files.upload()},select(e){},progress(e){},success(o){for(let e=0;e<o.tempFiles.length;e++)this.imageFile_list.push(o.tempFiles[e]);e.index.showModal({content:"上传图片成功",showCancel:!1})},fail(o){e.index.showModal({content:"上传失败，请重新上传",showCancel:!1})},async saveMallInfoData(o){const{success:s,fail:t}=o;try{const o={mall_name:this.formData.mall_name,imageFile_list:JSON.stringify(this.imageFile_list)};console.log(o);const i=await e.er.callFunction({name:"saveMallData",data:{action:"add",tableName:"mall_info",data:o}});console.log(i),console.log(i.header["x-serverless-http-status"]),console.log(i.result.code),console.log(i.success),console.log(i.result.message),i.success&&!i.result.code&&"200"==i.header["x-serverless-http-status"]?setTimeout((()=>{console.log("success_"),s(i),"function"==typeof s&&s(i)}),500):"function"==typeof t&&t(i)}catch(i){"function"==typeof t&&t(result)}}}};if(!Array){(e.resolveComponent("uni-easyinput")+e.resolveComponent("uni-forms-item")+e.resolveComponent("uni-forms")+e.resolveComponent("uni-card")+e.resolveComponent("uni-file-picker")+e.resolveComponent("uni-section"))()}Math||((()=>"../../../uni_modules/uni-easyinput/components/uni-easyinput/uni-easyinput.js")+(()=>"../../../uni_modules/uni-forms/components/uni-forms-item/uni-forms-item.js")+(()=>"../../../uni_modules/uni-forms/components/uni-forms/uni-forms.js")+(()=>"../../../uni_modules/uni-card/components/uni-card/uni-card.js")+(()=>"../../../uni_modules/uni-file-picker/components/uni-file-picker/uni-file-picker.js")+(()=>"../../../uni_modules/uni-section/components/uni-section/uni-section.js"))();const i=e._export_sfc(t,[["render",function(o,s,t,i,a,n){return{a:e.o((e=>a.formData.mall_name=e)),b:e.p({clearable:!1,placeholder:"请输入店铺名称",modelValue:a.formData.mall_name}),c:e.p({name:"mall_name",label:"店铺名称",required:!0}),d:e.sr("form","6639ec0e-0"),e:e.o(n.submit),f:e.o((e=>a.formData=e)),g:e.p({rules:a.rules,validateTrigger:"bind",modelValue:a.formData}),h:e.p({"is-shadow":!1,"is-full":!0}),i:e.sr("files","6639ec0e-5,6639ec0e-4"),j:e.o(n.select),k:e.o(n.progress),l:e.o(n.success),m:e.o(n.fail),n:e.p({limit:"12",title:"最多选择9张图片","auto-upload":!1,"disable-preview":!1}),o:e.o(((...e)=>n.upload&&n.upload(...e))),p:e.p({title:"只选择图片",type:"line"}),q:e.t(o.$t("common.button.submit")),r:e.o(((...e)=>n.submitForm&&n.submitForm(...e))),s:e.t(o.$t("common.button.back"))}}]]);wx.createPage(i);
